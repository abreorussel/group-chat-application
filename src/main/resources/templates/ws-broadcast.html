<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Plain WebSocket Example</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" th:href="@{/webjars/bootstrap/4.4.1/css/bootstrap.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/main.css}"/>
    <script th:src="@{/webjars/jquery/3.4.1/jquery.js}" ></script>
</head>
<body>
<div class="container">
    <div class="py-5 text-center">
        <h2>Basic Web socket</h2>
        <p class="lead">Sample of basic WebSocket broadcast - without STOMP & SockJS.</p>
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="row mb-3">
                <div class="input-group">
                    Web socket connection:&nbsp;
                    <div class="btn-group">
                        <button class="btn btn-sm btn-outline-secondary" id="connect" onclick="connect()" type="button">
                            Connect
                        </button>
                        <button class="btn btn-sm btn-outline-secondary" disabled id="disconnect"
                                onclick="disconnect()" type="button">Disconnect
                        </button>
                    </div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="input-group" id="sendmessage" style="display: none;">
                    <input class="form-control" id="message" placeholder="Message" type="text">
                    <div class="input-group-append">
                        <button class="btn btn-primary" id="send" onclick="send()">Send</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div id="content"></div>
        </div>
    </div>
</div>
<script>
            var ws;
            function setConnected(connected) {
                $("#connect").prop("disabled", connected);
                $("#disconnect").prop("disabled", !connected);

                if (connected) {

                    $("#sendmessage").show();

                } else {

                    $("#sendmessage").hide();

                }

            }

            function connect() {

                /*<![CDATA[*/

                var url = /*[['ws://'+${#httpServletRequest.serverName}+':'+${#httpServletRequest.serverPort}+@{/web-socket}]]*/ 'ws://localhost:9001/web-socket';

                /*]]>*/

                ws = new WebSocket(url);

                ws.onopen = function () {

                    showBroadcastMessage('<div class="alert alert-success">Connected to server</div>');

                };

                ws.onmessage = function (data) {

                    showBroadcastMessage(createTextNode(data.data));

                };

                setConnected(true);

            }



            function disconnect() {

                if (ws != null) {

                    ws.close();

                    showBroadcastMessage('<div class="alert alert-warning">Disconnected from server</div>');

                }

                setConnected(false);

            }



            function send() {

                ws.send($("#message").val());

                $("#message").val("");

            }



            function createTextNode(msg) {

                return '<div class="alert alert-info">' + msg + '</div>';

            }



            function showBroadcastMessage(message) {

                $("#content").html($("#content").html() + message);

            }
</script>
</body>
</html>